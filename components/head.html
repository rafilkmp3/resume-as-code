<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <title>{{basics.name}} - {{basics.label}}</title>
    <meta name="author" content="{{basics.name}}">
    <meta name="description" content="{{basics.summary}}">

    <!-- Build metadata for cache busting and version tracking -->
    <meta name="generator" content="Resume-as-Code">
    <meta name="app-version" content="{{appVersion}}">
    <meta name="app-environment" content="development">
    <meta name="app-channel" content="development">
    <meta name="app-branch" content="development">
    <meta name="build-commit" content="dev-local">
    <meta name="build-timestamp" content="2025-01-08T00:00:00.000Z">
    <meta name="commits-ahead" content="3">
    <meta name="last-release-tag" content="v4.1.0">
    <meta name="github-run-id" content="">
    <meta name="github-run-number" content="">
    <meta name="github-pr-number" content="">
    <meta name="keywords" content="resume, cv, {{basics.name}}, {{basics.label}}, platform engineer, devops, cloud architect, aws, gcp, kubernetes">

    <!-- Cache busting headers -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://rafaelbsathler.github.io/resume-as-code/">
    <meta property="og:title" content="{{basics.name}} - {{basics.label}}">
    <meta property="og:description" content="{{basics.summary}}">
    {{#if profileImageOptimization}}
    <meta property="og:image" content="{{profileImageOptimization.primaryJPEG}}">
    {{else}}
    <meta property="og:image" content="{{basics.image}}">
    {{/if}}

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://rafaelbsathler.github.io/resume-as-code/">
    <meta property="twitter:title" content="{{basics.name}} - {{basics.label}}">
    <meta property="twitter:description" content="{{basics.summary}}">
    {{#if profileImageOptimization}}
    <meta property="twitter:image" content="{{profileImageOptimization.primaryJPEG}}">
    {{else}}
    <meta property="twitter:image" content="{{basics.image}}">
    {{/if}}

    <!-- Enhanced Google Analytics 4 with Event Tracking -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1L4XD6LG6Z"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      // Build-time injected variables (SECURE: No frontend URL detection)
      const appVersion = '1.4.0'; // Auto-updated from package.json during build
      const commitHash = 'dev-local'; // Auto-updated from CI commit hash during build
      const buildTimestamp = '2025-01-08T00:00:00.000Z'; // Auto-updated during build
      const commitsAhead = 3; // Auto-updated with commits since last release during build  
      const lastReleaseTag = 'v4.1.0'; // Auto-updated with last release tag during build
      const runId = ''; // Auto-updated with GitHub Actions run ID during build
      const runNumber = ''; // Auto-updated with GitHub Actions run number during build
      const prNumber = ''; // Auto-updated with PR number during build
      const contextUrl = ''; // Auto-updated during build
      const compareUrl = ''; // Auto-updated during build
      const environment = 'development'; // Auto-updated with detected environment during build
      const channel = 'development'; // Auto-updated with deployment channel during build
      const branchName = 'development'; // Auto-updated with git branch during build

      // Enhanced GA4 configuration
      gtag('config', 'G-1L4XD6LG6Z', {
        send_page_view: true,
        anonymize_ip: true,
        allow_google_signals: true,
        custom_map: {
          'custom_parameter_1': 'resume_section',
          'custom_parameter_2': 'user_action',
          'custom_parameter_3': 'app_version',
          'custom_parameter_4': 'environment'
        },
        // Global parameters for all events
        app_version: appVersion,
        environment: environment,
        branch: branchName
      });

      // Enhanced event tracking will be loaded after DOM is ready

      // Enhanced version management system with hidden technical data
      document.addEventListener('DOMContentLoaded', function() {
        // User-friendly footer elements
        const userVersionElement = document.getElementById('user-version');
        const updateMonthElement = document.getElementById('update-month');
        const buildTimestampElement = document.getElementById('build-timestamp');
        const versionContextLink = document.getElementById('version-context-link');

        // Build time display
        if (buildTimestampElement) {
          const buildDate = new Date(buildTimestamp);
          const timeString = buildDate.toLocaleTimeString('en-US', { 
            hour12: false, 
            hour: '2-digit', 
            minute: '2-digit'
          });
          buildTimestampElement.textContent = timeString;
        }

        // Environment-specific display logic and contextual links
        if (userVersionElement && versionContextLink) {
          // Simplified version format with environment-specific enhancements
          const majorMinor = appVersion.split('.').slice(0, 2).join('.');
          let contextUrl = '#';
          let linkTitle = 'View version details';
          
          if (environment === 'production') {
            // Production: Clean version only, link to latest release
            userVersionElement.textContent = `v${majorMinor}`;
            contextUrl = `https://github.com/rafilkmp3/resume-as-code/releases/tag/${lastReleaseTag}`;
            linkTitle = `View release ${lastReleaseTag}`;
          } else if (environment === 'staging') {
            // Staging: Show commits ahead, link to staging pipeline
            const commitsAheadText = commitsAhead > 0 ? ` +${commitsAhead}` : '';
            userVersionElement.textContent = `v${majorMinor}${commitsAheadText}`;
            userVersionElement.style.color = '#f59e0b';
            userVersionElement.style.fontWeight = '600';
            contextUrl = 'https://github.com/rafilkmp3/resume-as-code/actions/workflows/staging.yml';
            linkTitle = 'View staging pipeline';
          } else if (environment === 'preview') {
            // Preview: Show commits ahead, link to PR
            const commitsAheadText = commitsAhead > 0 ? ` +${commitsAhead}` : '';
            userVersionElement.textContent = `v${majorMinor}${commitsAheadText}`;
            userVersionElement.style.color = '#3b82f6';
            userVersionElement.style.fontWeight = '600';
            
            // Extract PR number from URL if preview environment
            const currentUrl = window.location.hostname;
            const prMatch = currentUrl.match(/deploy-preview-(\d+)/);
            if (prMatch) {
              const prNumber = prMatch[1];
              contextUrl = `https://github.com/rafilkmp3/resume-as-code/pull/${prNumber}`;
              linkTitle = `View Pull Request #${prNumber}`;
            } else {
              contextUrl = 'https://github.com/rafilkmp3/resume-as-code/pulls';
              linkTitle = 'View pull requests';
            }
          } else {
            // Development: Show branch info, link to repository
            userVersionElement.textContent = `v${majorMinor} (${branchName})`;
            userVersionElement.style.color = '#10b981';
            userVersionElement.style.fontWeight = '600';
            contextUrl = 'https://github.com/rafilkmp3/resume-as-code';
            linkTitle = 'View repository';
          }
          
          // Set the contextual link
          versionContextLink.href = contextUrl;
          versionContextLink.title = linkTitle;
        }

        if (updateMonthElement) {
          // Format timestamp to user-friendly month format
          const buildDate = new Date(buildTimestamp);
          const monthYear = buildDate.toLocaleDateString('en-US', { 
            month: 'short', 
            year: 'numeric' 
          });
          updateMonthElement.textContent = monthYear;
          
          // Environment-specific timestamp styling
          if (environment !== 'production') {
            updateMonthElement.style.fontSize = '0.875rem';
            updateMonthElement.style.opacity = '0.8';
          }
        }

        // Hidden Technical Data System - Console Logging
        console.group('üîß Resume-as-Code Technical Information');
        console.log('üìã Version Information:');
        console.table({
          'App Version': appVersion,
          'Environment': environment,
          'Channel': channel,
          'Branch': branchName,
          'Commits Ahead': commitsAhead > 0 ? `+${commitsAhead}` : 'Release',
          'Last Release': lastReleaseTag
        });
        
        console.log('üèóÔ∏è Build Information:');
        console.table({
          'Commit Hash': commitHash,
          'Build Timestamp': buildTimestamp,
          'GitHub Run ID': runId || 'Local build',
          'GitHub Run Number': runNumber || 'N/A',
          'PR Number': prNumber || 'N/A'
        });

        console.log('üîó Useful Links:');
        const links = {};
        if (environment === 'production') {
          links['Latest Release'] = `https://github.com/rafilkmp3/resume-as-code/releases/tag/${lastReleaseTag}`;
          links['Release Notes'] = `https://github.com/rafilkmp3/resume-as-code/releases`;
        } else if (environment === 'staging') {
          links['Staging Pipeline'] = 'https://github.com/rafilkmp3/resume-as-code/actions/workflows/staging.yml';
          links['Compare Changes'] = compareUrl || `https://github.com/rafilkmp3/resume-as-code/compare/${lastReleaseTag}...${commitHash}`;
        } else if (environment === 'preview' && prNumber) {
          links['Pull Request'] = `https://github.com/rafilkmp3/resume-as-code/pull/${prNumber}`;
          links['PR Pipeline'] = contextUrl || `https://github.com/rafilkmp3/resume-as-code/actions`;
        }
        
        if (commitHash !== 'dev-local') {
          links['Commit Details'] = `https://github.com/rafilkmp3/resume-as-code/commit/${commitHash}`;
        }
        links['Repository'] = 'https://github.com/rafilkmp3/resume-as-code';
        
        console.table(links);
        console.groupEnd();

        // Add version API endpoint data to window for external access
        window.resumeVersionAPI = {
          version: appVersion,
          environment: environment,
          channel: channel,
          branch: branchName,
          commit: commitHash,
          buildTimestamp: buildTimestamp,
          commitsAhead: commitsAhead,
          lastReleaseTag: lastReleaseTag,
          runId: runId,
          runNumber: runNumber,
          prNumber: prNumber,
          contextUrl: contextUrl,
          compareUrl: compareUrl,
          userFriendlyVersion: `v${appVersion.split('.').slice(0, 2).join('.')}`,
          lastUpdated: new Date(buildTimestamp).toLocaleDateString('en-US', { 
            month: 'short', 
            year: 'numeric' 
          })
        };
      });
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "{{basics.name}}",
      "url": "{{basics.url}}",
      {{#if profileImageOptimization}}
      "image": "{{profileImageOptimization.primaryJPEG}}",
      {{else}}
      "image": "{{basics.image}}",
      {{/if}}
      "sameAs": [
        {{#each basics.profiles}}
        "{{url}}"{{#unless @last}},{{/unless}}
        {{/each}}
      ],
      "jobTitle": "{{basics.label}}",
      "worksFor": {
        "@type": "Organization",
        "name": "{{work.0.name}}"
      },
      "alumniOf": {
        "@type": "CollegeOrUniversity",
        "name": "{{education.0.institution}}"
      },
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "{{basics.location.city}}",
        "addressRegion": "{{basics.location.region}}",
        "addressCountry": "{{basics.location.countryCode}}"
      },
      "email": "mailto:{{basics.email}}",
      "telephone": "{{basics.phone}}"
    }
    </script>
