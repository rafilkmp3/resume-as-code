---
name: ðŸ“‹ Release Management

on:
  push:
    branches:
      - main

concurrency:
  group: release-please-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  release-please:
    name: ðŸ“‹ Update Release PR (Changelog + Version)
    runs-on: ubuntu-24.04-arm
    outputs:
      release_created: ${{ steps.release.outputs.release_created }}
      tag_name: ${{ steps.release.outputs.tag_name }}
    steps:
      - name: ðŸ“ Update Release PR (Release-Please)
        uses: googleapis/release-please-action@v4
        id: release
        with:
          config-file: .release-please-config.json
          manifest-file: .release-please-manifest.json
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ“‹ Release Process Status Summary
        run: |
          echo "## ðŸ“‹ Release Process Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ "${{ steps.release.outputs.release_created }}" = "true" ]; then
            echo "âœ… **RELEASE CREATED** - Production deployment will be triggered" >> $GITHUB_STEP_SUMMARY
            echo "ðŸš€ **Status**: Release v${{ steps.release.outputs.tag_name }} created" >> $GITHUB_STEP_SUMMARY
            echo "ðŸ“‹ **Next**: Production deployment workflow will automatically start" >> $GITHUB_STEP_SUMMARY
          else
            echo "ðŸ“ **RELEASE PR UPDATED** - No deployment yet" >> $GITHUB_STEP_SUMMARY
            echo "â³ **Status**: Updated release-please PR with new commits" >> $GITHUB_STEP_SUMMARY
            echo "ðŸ’¡ **Next Step**: Merge the release-please PR to create a GitHub Release" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ðŸ“‹ Current Action" >> $GITHUB_STEP_SUMMARY
            echo "- âœ… Updated release-please PR with latest commits" >> $GITHUB_STEP_SUMMARY
            echo "- âœ… Generated/updated CHANGELOG.md" >> $GITHUB_STEP_SUMMARY
            echo "- âœ… Bumped version number in package.json" >> $GITHUB_STEP_SUMMARY
            echo "- â³ **Waiting for PR merge to create GitHub Release**" >> $GITHUB_STEP_SUMMARY
            echo "- ðŸ“ **Note**: Production deployment happens automatically when release is published" >> $GITHUB_STEP_SUMMARY
          fi

