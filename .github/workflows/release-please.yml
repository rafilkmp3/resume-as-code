---
name: 📋 Release Management

on:
  push:
    branches:
      - main

concurrency:
  group: release-please-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  release-please:
    name: 📋 Update Release PR (Changelog + Version)
    runs-on: ubuntu-24.04-arm
    outputs:
      release_created: ${{ steps.release.outputs.release_created }}
      tag_name: ${{ steps.release.outputs.tag_name }}
    steps:
      - name: 📝 Update Release PR (Release-Please)
        uses: googleapis/release-please-action@v4
        id: release
        with:
          config-file: .release-please-config.json
          manifest-file: .release-please-manifest.json
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 📋 Release Process Status Summary
        run: |
          echo "## 📋 Release Process Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ "${{ steps.release.outputs.release_created }}" = "true" ]; then
            echo "✅ **RELEASE CREATED** - Production deployment triggered" >> $GITHUB_STEP_SUMMARY
            echo "🚀 **Status**: Release v${{ steps.release.outputs.tag_name }} created and deployment starting" >> $GITHUB_STEP_SUMMARY
          else
            echo "📝 **RELEASE PR UPDATED** - No deployment yet" >> $GITHUB_STEP_SUMMARY
            echo "⏳ **Status**: Updated release-please PR with new commits" >> $GITHUB_STEP_SUMMARY
            echo "💡 **Next Step**: Merge the release-please PR to trigger production deployment" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### 📋 Current Action" >> $GITHUB_STEP_SUMMARY
            echo "- ✅ Updated release-please PR with latest commits" >> $GITHUB_STEP_SUMMARY
            echo "- ✅ Generated/updated CHANGELOG.md" >> $GITHUB_STEP_SUMMARY
            echo "- ✅ Bumped version number in package.json" >> $GITHUB_STEP_SUMMARY
            echo "- ⏳ **Waiting for PR merge to deploy to production**" >> $GITHUB_STEP_SUMMARY
          fi

