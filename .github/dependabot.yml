---
# Optimized Dependabot configuration for reduced noise and better automation
# https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/configuration-options-for-the-dependabot.yml-file

version: 2
updates:
  # NPM dependencies - Smart grouping to reduce PR noise
  - package-ecosystem: 'npm'
    directory: '/'
    schedule:
      interval: 'weekly'
      day: 'monday'
      time: '09:00'
      timezone: 'America/Sao_Paulo'
    open-pull-requests-limit: 3  # Reduced from 5 to minimize noise
    rebase-strategy: 'auto'
    commit-message:
      prefix: 'chore(deps)'
      prefix-development: 'chore(deps-dev)'
      include: 'scope'
    labels:
      - 'dependencies'
      - 'chore'
    # Intelligent grouping to reduce PR volume
    groups:
      # Critical production dependencies - separate for careful review
      production-critical:
        patterns:
          - 'handlebars'
          - 'puppeteer'
          - 'express'
        update-types:
          - 'patch'
          - 'minor'
      # Standard production dependencies - grouped together
      production-dependencies:
        patterns:
          - '*'
        exclude-patterns:
          - '@types/*'
          - '*-types'
          - 'jest*'
          - 'playwright*'
          - '@babel/*'
          - 'babel-*'
          - 'eslint*'
          - 'handlebars'  # Handled separately
          - 'puppeteer'   # Handled separately
          - 'express'     # Handled separately
        update-types:
          - 'patch'
          - 'minor'
      # Development dependencies - less critical, can be grouped aggressively
      development-dependencies:
        patterns:
          - '@types/*'
          - '*-types'
          - 'jest*'
          - 'playwright*'
          - '@babel/*'
          - 'babel-*'
          - 'eslint*'
          - '@eslint/*'
        update-types:
          - 'patch'
          - 'minor'
    # Strategic ignores to avoid breaking changes
    ignore:
      # Major version updates require manual review
      - dependency-name: '*'
        update-types: ['version-update:semver-major']
      # Playwright can be flaky with auto-updates
      - dependency-name: 'playwright'
        update-types: ['version-update:semver-major', 'version-update:semver-minor']
      # Keep Handlebars stable
      - dependency-name: 'handlebars'
        update-types: ['version-update:semver-major']

  # Docker dependencies - Less frequent updates
  - package-ecosystem: 'docker'
    directory: '/docker'
    schedule:
      interval: 'monthly'  # Less frequent than npm
      day: 'monday'
      time: '09:00'
      timezone: 'America/Sao_Paulo'
    open-pull-requests-limit: 2  # Very limited
    rebase-strategy: 'auto'
    commit-message:
      prefix: 'chore(deps-docker)'
      include: 'scope'
    labels:
      - 'dependencies'
      - 'docker'
      - 'chore'
    # Group all Docker updates together
    groups:
      docker-images:
        patterns:
          - '*'
        update-types:
          - 'patch'
          - 'minor'

  # GitHub Actions - Quarterly updates for stability
  - package-ecosystem: 'github-actions'
    directory: '/'
    schedule:
      interval: 'monthly'
      day: 'monday'
      time: '09:00'
      timezone: 'America/Sao_Paulo'
    open-pull-requests-limit: 2
    rebase-strategy: 'auto'
    commit-message:
      prefix: 'ci'
      include: 'scope'
    labels:
      - 'github-actions'
      - 'ci/cd'
      - 'chore'
    # Group GitHub Actions updates
    groups:
      github-actions:
        patterns:
          - '*'
        update-types:
          - 'patch'
          - 'minor'
    # Ignore major updates for critical actions
    ignore:
      - dependency-name: '*'
        update-types: ['version-update:semver-major']
